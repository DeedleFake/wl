// Code generated by wlgen. DO NOT EDIT.

package {{.Package}}

import (
	{{range .ExtraImports -}}
		{{. | printf "%q"}}
	{{end -}}
	"deedles.dev/wl/wire"
)

{{range .Protocol.Interfaces}}
	{{- $name := .Name | trimPrefix $.Prefix | camel | unexport -}}
	{{- $listeners := listeners $.IsClient . -}}
	{{- $senders := senders $.IsClient . -}}

	const (
		{{$name}}Name = {{.Name | printf "%q"}}
		{{$name}}Version = {{.Version}}
	)

	{{.Description.Full | trimSpace | trimLines | comment -}}
	type {{$name}}Object struct {
		id uint32
		delete func()
		{{if ne (len $listeners) 0 -}}
			listener interface {
				{{range $listeners -}}
					{{.Description.Full | trimSpace | trimLines | comment -}}
					{{.Name | camel | export}}({{range .Args}}{{.Name | camel | unexport | unkeyword}} {{. | goType}}, {{end}})

				{{end}}
			}
		{{end}}
	}

	func (obj {{$name}}Object) Dispatch(msg *wire.MessageBuffer) error {
		switch msg.Op() {
		{{- range $op, $method := $listeners}}
			case {{$op}}:
				{{range $method.Args -}}
					{{.Name | camel | unexport | unkeyword}} := msg.Read{{. | typeFuncSuffix}}()
				{{end -}}
				if err := msg.Err(); err != nil {
					return err
				}
				obj.listener.{{.Name | camel | export}}(
					{{range $method.Args -}}
						{{.Name | camel | unexport | unkeyword}},
					{{end -}}
				)
				return nil
		{{end -}}
		}

		return wire.UnknownOpError{
			Interface: {{.Name | printf "%q"}},
			Type: {{if $.IsClient -}} "event" {{- else -}} "request" {{- end}},
			Op: msg.Op(),
		}
	}

	func (obj *{{$name}}Object) SetID(id uint32) {
		obj.id = id
	}

	func (obj {{$name}}Object) Delete() {
		if obj.delete != nil {
			obj.delete()
		}
	}

	{{range $op, $method := $senders}}
		{{$method.Description.Full | trimSpace | trimLines | comment -}}
		func (obj {{$name}}Object) {{$method.Name | camel | export}}({{range $method.Args}}{{.Name | camel | unexport | unkeyword}} {{. | goType}}, {{end}}) *wire.MessageBuilder {
			builder := wire.MessageBuilder{
				Sender: obj.id,
				Op: {{$op}},
			}

			{{range $method.Args -}}
				builder.Write{{. | typeFuncSuffix}}({{.Name | camel | unexport | unkeyword}})
			{{end}}

			return &builder
		}
	{{end}}

	{{range $enum := .Enums}}
		{{- $enumName := printf "%s%s" ($name | export) (.Name | camel | export) | unexport -}}

		{{$enum.Description.Full | trimSpace | trimLines | comment -}}
		type {{$enumName}} int32

		const (
			{{range .Entries -}}
				{{.Summary | trimSpace | trimLines | comment -}}
				{{$enumName}}{{.Name | camel | export}} {{$enumName}} = {{.Int}}

			{{end}}
		)
	{{end}}
{{end}}
