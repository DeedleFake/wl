// Code generated by wlgen. DO NOT EDIT.

package {{.Package}}

import (
	{{range .ExtraImports -}}
		{{. | printf "%q"}}
	{{end -}}
	"deedles.dev/wl/wire"
)

{{range .Protocol.Interfaces}}
	{{- $name := .Name | trimPrefix $.Prefix | camel | unexport -}}
	{{- $listeners := listeners $.IsClient . -}}
	{{- $senders := senders $.IsClient . -}}

	type {{$name}}Object struct {
		id uint32
		listener interface {
			{{range $listeners}}
				{{- .Name | camel | export}}({{range .Args}}{{.Name | camel | unexport | unkeyword}} {{.Type | goType}}, {{end}})
			{{end}}
		}
	}

	func (obj {{$name}}Object) Dispatch(msg *wire.MessageBuffer) error {
		switch msg.Op() {
		{{- range $op, $method := $listeners}}
			case {{$op}}:
				{{range $method.Args -}}
					{{.Name}} := msg.Read{{.Type | typeFuncSuffix}}()
				{{end -}}
				if err := msg.Err(); err != nil {
					return err
				}
				obj.listener.{{.Name | camel | export}}(
					{{range $method.Args -}}
						{{.Name}},
					{{end -}}
				)
		{{end -}}
		}

		return wire.UnknownOpError{
			Interface: {{.Name | printf "%q"}},
			Type: {{if $.IsClient -}} "event" {{- else -}} "request" {{- end}},
			Op: msg.Op(),
		}
	}

	{{range $op, $method := $senders -}}
		func (obj {{$name}}Object) {{$method.Name | camel | export}}({{range $method.Args}}{{.Name | camel | unexport | unkeyword}} {{.Type | goType}}, {{end}}) *wire.MessageBuilder {
			builder := wire.MessageBuilder{
				Sender: obj.id,
				Op: {{$op}},
			}

			{{range $method.Args -}}
				builder.Write{{.Type | typeFuncSuffix}}({{.Name | camel | unexport | unkeyword}})
			{{end}}

			return &builder
		}
	{{end}}
{{end}}
